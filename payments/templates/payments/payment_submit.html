<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Upload Payment Proof | Campus Connect</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{--g:#16a34a;--g2:#22c55e;--bd:rgba(15,23,42,.10);--muted:#64748b;}
    body{
      background:
        radial-gradient(900px 450px at 15% 10%, rgba(34,197,94,0.16), transparent 55%),
        linear-gradient(120deg,#fff 0%,#f7fbf8 65%,#fff 100%);
      font-family:system-ui;
    }
    .wrap{max-width:980px;margin:0 auto;padding:26px 16px 40px;}
    .cardx{border-radius:18px;border:1px solid var(--bd);background:rgba(255,255,255,.95);box-shadow:0 14px 30px rgba(15,23,42,.06);}
    .pill{border-radius:999px;}
    .tag{
      display:inline-block;border-radius:999px;padding:.35rem .7rem;font-weight:900;font-size:.85rem;
      border:1px solid rgba(15,23,42,.12);background:#f1f5f9;color:#0f172a;
    }
    .tagPaid{background:rgba(34,197,94,.12);border-color:rgba(34,197,94,.22);color:#166534;}
    .help{
      color:var(--muted);
      font-weight:650;
      font-size:.92rem;
    }
    .soft{
      background:rgba(15,23,42,.03);
      border:1px dashed rgba(15,23,42,.14);
      border-radius:16px;
      padding:14px;
    }
  </style>
</head>

<body>
<div class="wrap">

  <!-- HEADER -->
  <div class="cardx p-4 mb-3 d-flex justify-content-between align-items-start gap-3">
    <div>
      <h3 class="fw-bold mb-1">Upload Payment Proof</h3>

      <div class="help">
        <div class="fw-semibold text-dark">{{ event.title }}</div>
        <div class="small">
          Amount:
          <span class="tag tagPaid">Rs {{ event.price }}</span>
          {% if proof %}
            <span class="ms-2 tag">Current: {{ proof.get_status_display }}</span>
          {% endif %}
        </div>
      </div>
    </div>

    <a class="btn btn-outline-dark pill px-3" href="{% url 'events:detail' event.id %}">Back</a>
  </div>

  <!-- MESSAGES -->
  {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} mb-2">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="row g-3">
    <!-- LEFT: CURRENT PROOF -->
    <div class="col-lg-5">
      <div class="cardx p-4 h-100">

        <h6 class="fw-bold mb-2">Current Proof</h6>

        {% if proof and proof.proof_image %}
          <div class="soft mb-3">
            <div class="small fw-semibold mb-2">Uploaded file</div>
            <a class="btn btn-outline-primary btn-sm pill" target="_blank" href="{{ proof.proof_image.url }}">
              View uploaded proof
            </a>

            <div class="small mt-2" style="color:var(--muted);font-weight:650;">
              Status: <b class="text-dark">{{ proof.get_status_display }}</b>
            </div>

            {% if proof.status == "rejected" %}
              <div class="alert alert-danger mt-3 mb-0">
                Your proof was rejected. Please upload a clearer screenshot.
              </div>
            {% elif proof.status == "approved" %}
              <div class="alert alert-success mt-3 mb-0">
                Approved ✅ No further action needed.
              </div>
            {% else %}
              <div class="alert alert-warning mt-3 mb-0">
                Pending ⏳ Staff will review soon.
              </div>
            {% endif %}
          </div>
        {% else %}
          <div class="soft">
            <div class="help">
              No proof uploaded yet. Pay using the QR code on the event page, then upload a screenshot here.
            </div>
          </div>
        {% endif %}

        <div class="mt-3 help">
          Tip: include the transaction ID and amount clearly in the screenshot.
        </div>

      </div>
    </div>

    <!-- RIGHT: UPLOAD FORM -->
    <div class="col-lg-7">
      <div class="cardx p-4">

        <h6 class="fw-bold mb-2">{% if proof %}Re-upload Proof{% else %}Submit Proof{% endif %}</h6>
        <div class="help mb-3">
          Choose the payment method and upload your payment screenshot/receipt.
        </div>

        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Payment Method</label>
              <select class="form-select" name="gateway" required>
                <option value="esewa" {% if proof and proof.gateway == "esewa" %}selected{% endif %}>eSewa</option>
                <option value="khalti" {% if proof and proof.gateway == "khalti" %}selected{% endif %}>Khalti</option>
                <option value="bank" {% if proof and proof.gateway == "bank" %}selected{% endif %}>Bank Transfer</option>
                <option value="cash" {% if proof and proof.gateway == "cash" %}selected{% endif %}>Cash</option>
              </select>
              <div class="small mt-1" style="color:var(--muted);font-weight:650;">
                This is stored for admin/staff verification.
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label fw-semibold">Amount (auto)</label>
              <input class="form-control" value="Rs {{ event.price }}" disabled>
              <div class="small mt-1" style="color:var(--muted);font-weight:650;">
                Amount is taken from the event price.
              </div>
            </div>

            <div class="col-12">
              <label class="form-label fw-semibold">Upload Screenshot / Receipt</label>
              <input class="form-control" type="file" name="proof_image" accept="image/*" {% if not proof %}required{% endif %}>
              <div class="small mt-2" style="color:var(--muted);font-weight:650;">
                PNG/JPG recommended. Clear proof helps faster approval.
              </div>
            </div>
          </div>

          <div class="d-flex gap-2 mt-4">
            <button class="btn btn-success pill px-4" type="submit">
              {% if proof %}Update Proof{% else %}Submit Proof{% endif %}
            </button>

            <a class="btn btn-outline-dark pill px-4" href="{% url 'events:detail' event.id %}">
              Cancel
            </a>
          </div>

        </form>

      </div>
    </div>
  </div>

</div>
</body>
</html>
