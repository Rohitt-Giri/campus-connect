{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lost & Found | Campus Connect</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{--g:#16a34a;--bd:rgba(15,23,42,.10);--muted:#64748b;}
    body{background: radial-gradient(circle at top left,#e9fff2 0%,#f4fff8 30%,#f7fbff 70%,#fff 100%); font-family:system-ui;}
    .wrap{max-width:1180px; margin:0 auto; padding:28px 16px;}
    .cardx{border-radius:18px; border:1px solid var(--bd); background:rgba(255,255,255,.92); box-shadow:0 14px 30px rgba(15,23,42,.06);}
    .pill{border-radius:999px;}
    .tag{border-radius:999px; padding:.32rem .65rem; font-weight:800; font-size:.85rem; border:1px solid rgba(15,23,42,.12);}
    .tag-lost{background:rgba(239,68,68,.10); color:#991b1b; border-color:rgba(239,68,68,.20);}
    .tag-found{background:rgba(34,197,94,.12); color:#166534; border-color:rgba(34,197,94,.20);}
    .tag-open{background:rgba(59,130,246,.10); color:#1d4ed8; border-color:rgba(59,130,246,.20);}
    .tag-returned{background:rgba(100,116,139,.12); color:#334155; border-color:rgba(100,116,139,.22);}
    a{color:inherit;}
  </style>
</head>
<body>
  <div class="wrap">

    <div class="cardx p-4 mb-3 d-flex justify-content-between align-items-center">
      <div>
        <h3 class="fw-bold mb-1">Lost & Found</h3>
        <div class="text-muted">Browse items posted by students and submit claims.</div>
      </div>
      <div class="d-flex gap-2 flex-wrap">
        <a class="btn btn-outline-dark pill" href="javascript:history.back()">Back</a>
        <a class="btn btn-outline-dark pill" href="{% url 'lostfound:my_posts' %}">My Posts</a>
        <a class="btn btn-outline-dark pill" href="{% url 'lostfound:my_claims' %}">My Claims</a>
        <a class="btn btn-success pill" href="{% url 'lostfound:create' %}">+ Post Item</a>
      </div>
    </div>

    {% if messages %}
      <div class="mb-3">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} mb-2">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="cardx p-3 mb-3">
      <form method="get" class="row g-2 align-items-center">
        <div class="col-md-6">
          <input class="form-control" name="q" value="{{ q }}" placeholder="Search title/location/keywords">
        </div>
        <div class="col-md-2">
          <select class="form-select" name="type">
            <option value="">All types</option>
            <option value="lost" {% if type == "lost" %}selected{% endif %}>Lost</option>
            <option value="found" {% if type == "found" %}selected{% endif %}>Found</option>
          </select>
        </div>
        <div class="col-md-2">
          <select class="form-select" name="status">
            <option value="">All status</option>
            <option value="open" {% if status == "open" %}selected{% endif %}>Open</option>
            <option value="returned" {% if status == "returned" %}selected{% endif %}>Returned</option>
          </select>
        </div>
        <div class="col-md-2 d-grid">
          <button class="btn btn-dark pill">Filter</button>
        </div>
      </form>
    </div>

    <div class="row g-3">
      {% for i in items %}
        <div class="col-md-6 col-lg-4">
          <div class="cardx p-3 h-100">
            <div class="d-flex justify-content-between align-items-start gap-2">
              <div class="fw-bold">
                <a class="text-decoration-none" href="{% url 'lostfound:detail' i.pk %}">{{ i.title }}</a>
              </div>
              <span class="tag {% if i.item_type == 'lost' %}tag-lost{% else %}tag-found{% endif %}">
                {{ i.get_item_type_display }}
              </span>
            </div>

            <div class="text-muted small mt-1">
              {% if i.location %}{{ i.location }}{% else %}—{% endif %}
              • {% if i.date_happened %}{{ i.date_happened|date:"M d, Y" }}{% else %}{{ i.created_at|date:"M d, Y" }}{% endif %}
            </div>

            {% if i.image %}
              <img
                src="{% if i.image|slice:':4' == 'http' %}{{ i.image }}{% else %}{{ MEDIA_URL }}{{ i.image }}{% endif %}"
                class="mt-2 w-100"
                style="border-radius:14px; aspect-ratio: 16/9; object-fit: cover;"
                onerror="this.style.display='none';"
              >
            {% endif %}


            <div class="d-flex justify-content-between align-items-center mt-3">
              <span class="tag {% if i.status == 'open' %}tag-open{% else %}tag-returned{% endif %}">
                {{ i.get_status_display }}
              </span>
              <a class="btn btn-outline-dark pill btn-sm" href="{% url 'lostfound:detail' i.pk %}">View</a>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12">
          <div class="cardx p-4 text-muted">No items found.</div>
        </div>
      {% endfor %}
    </div>

  </div>
</body>
</html>
