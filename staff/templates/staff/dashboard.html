{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Campus Connect | Staff Dashboard</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg:#f7fbf8;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --border: rgba(15,23,42,0.10);

      --green:#16a34a;
      --green2:#22c55e;
      --green-soft:#eafff1;

      --shadow: 0 18px 45px rgba(15,23,42,0.10);
      --shadow2: 0 10px 28px rgba(15,23,42,0.08);
      --radius: 18px;
    }

    body{
      min-height:100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
      background:
        radial-gradient(900px 450px at 15% 10%, rgba(34,197,94,0.16), transparent 55%),
        linear-gradient(120deg, #ffffff 0%, var(--bg) 65%, #ffffff 100%);
    }

    /* Topbar */
    .cc-nav{
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }
    .brand{
      text-decoration:none;
      color: var(--text);
      font-weight: 900;
      letter-spacing: -0.02em;
      display:flex;
      align-items:center;
      gap:.75rem;
    }
    .brand-badge{
      width: 44px;
      height: 44px;
      border-radius: 14px;
      background: linear-gradient(135deg, var(--green), var(--green2));
      display:flex;
      align-items:center;
      justify-content:center;
      color: #06120a;
      font-weight: 950;
      box-shadow: 0 14px 30px rgba(34,197,94,0.22);
    }

    .btn-pill{
      border-radius: 999px;
      padding: .55rem 1.1rem;
      font-weight: 800;
    }
    .btn-ghost{
      border: 1px solid rgba(15,23,42,0.18);
      background: #fff;
      color: var(--text);
    }
    .btn-ghost:hover{ background: #f8fafc; }

    .btn-primary-cc{
      border: 0;
      border-radius: 999px;
      padding: .6rem 1.15rem;
      font-weight: 900;
      color: #06120a;
      background: linear-gradient(135deg, var(--green), var(--green2));
      box-shadow: 0 16px 34px rgba(34,197,94,0.22);
    }
    .btn-primary-cc:hover{ filter: brightness(1.02); }

    /* Layout */
    .wrap{ padding: 2rem 0 3rem; }
    .page-title{
      font-weight: 950;
      letter-spacing: -0.02em;
      margin-bottom: .25rem;
    }
    .sub{
      color: var(--muted);
      font-weight: 600;
    }

    /* Cards */
    .cc-card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
    }
    .cc-card-pad{ padding: 1.25rem; }

    /* Stats */
    .stat{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 1rem;
    }
    .stat-label{
      color: var(--muted);
      font-weight: 800;
      font-size: .92rem;
    }
    .stat-value{
      font-weight: 950;
      font-size: 1.8rem;
      letter-spacing: -0.02em;
    }
    .stat-badge{
      border-radius: 999px;
      padding: .35rem .7rem;
      font-weight: 800;
      font-size: .85rem;
      background: rgba(34,197,94,0.10);
      border: 1px solid rgba(34,197,94,0.18);
      color: #0b3d1f;
      white-space: nowrap;
    }

    /* Actions */
    .action{
      display:flex;
      align-items:flex-start;
      gap: .9rem;
      padding: 1.1rem;
      border-radius: 16px;
      border: 1px solid rgba(15,23,42,0.08);
      background: #fff;
      box-shadow: 0 10px 24px rgba(2,6,23,0.06);
      text-decoration:none;
      color: var(--text);
      transition: transform .12s ease;
      height: 100%;
    }
    .action:hover{
      transform: translateY(-2px);
      color: var(--text);
    }
    .icon{
      width: 46px;
      height: 46px;
      border-radius: 16px;
      background: rgba(34,197,94,0.12);
      border: 1px solid rgba(34,197,94,0.22);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 950;
      color: #0b3d1f;
      flex: 0 0 auto;
    }
    .action h6{
      font-weight: 900;
      margin: 0 0 .25rem;
    }
    .action p{
      margin: 0;
      color: var(--muted);
      font-weight: 600;
      line-height: 1.5;
      font-size: .95rem;
    }

    /* List */
    .list-item{
      display:flex;
      justify-content:space-between;
      gap: 1rem;
      padding: .9rem 0;
      border-top: 1px solid rgba(15,23,42,0.08);
    }
    .list-item:first-child{ border-top: 0; padding-top: 0; }
    .list-title{ font-weight: 900; margin: 0 0 .15rem; }
    .list-meta{
      color: var(--muted);
      font-weight: 600;
      font-size: .92rem;
    }
    .pill{
      border-radius: 999px;
      padding: .32rem .65rem;
      font-weight: 800;
      font-size: .85rem;
      border: 1px solid rgba(15,23,42,0.12);
      color: var(--muted);
      background: #fff;
      white-space: nowrap;
    }

    footer{
      color: var(--muted);
      font-weight: 600;
      font-size: .9rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(15,23,42,0.10);
      margin-top: 2rem;
    }
  </style>
</head>

<body>
  <!-- Topbar -->
  <nav class="cc-nav py-3">
    <div class="container d-flex align-items-center justify-content-between gap-3">
      <a class="brand" href="{% url 'core:landing' %}">
        <span class="brand-badge">CC</span>
        <span>Campus Connect</span>
      </a>

      <div class="d-flex align-items-center gap-2">
        <div class="d-none d-md-block small" style="color:var(--muted); font-weight:700;">
          Staff:
          <span style="color:var(--text); font-weight:900;">
            {{ request.user.username|default:"Staff" }}
          </span>
        </div>
        <a class="btn btn-pill btn-ghost" href="{% url 'accounts:logout' %}">Logout</a>
      </div>
    </div>
  </nav>

  <main class="wrap">
    <div class="container">

      <!-- Header -->
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-4">
        <div>
          <h2 class="page-title">Staff Dashboard</h2>
          <div class="sub">Manage events, publish notices, and handle lost &amp; found requests.</div>
        </div>

        <div class="d-flex gap-2 flex-wrap">
          <!-- These URLs MUST exist in your project or Django will error -->
          <a href="{% url 'notices:list' %}" class="btn btn-outline-dark">View Notices</a>
          <a href="{% url 'notices:create' %}" class="btn btn-success">+ Create Notice</a>

          <!-- Event module later -->
          <a class="btn btn-success pill px-3" href="{% url 'events:create' %}">+ Create Event</a>

        </div>
      </div>

      <!-- Stats -->
      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <div class="cc-card cc-card-pad">
            <div class="stat">
              <div>
                <div class="stat-label">Active Events</div>
                <div class="stat-value">{{ active_events|default:0 }}</div>
              </div>
              <span class="stat-badge">Demo</span>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="cc-card cc-card-pad">
            <div class="stat">
              <div>
                <div class="stat-label">Notices Published</div>
                <div class="stat-value">{{ published_count|default:0 }}</div>
              </div>
              <span class="stat-badge">Live</span>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="cc-card cc-card-pad">
            <div class="stat">
              <div>
               <a href="{% url 'lostfound:staff_items' %}" class="btn btn-outline-dark">Lost & Found Items</a>
                <a href="{% url 'lostfound:staff_claims' %}" class="btn btn-outline-dark">Claim Requests</a>

                <div class="stat-label">Pending Claims</div>
                <div class="stat-value">{{ pending_claims|default:0 }}</div>
              </div>
              <span class="stat-badge">Demo</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="row g-3 mb-4">
        <a href="{% url 'events:list' %}" class="text-decoration-none">
          <div class="module-card hover-shadow">
            <div class="d-flex align-items-center gap-3">
              <div class="module-icon">EV</div>
              <div>
                <h5 class="fw-bold mb-1">Manage Events</h5>
                <p class="text-muted mb-0">
                  Create, update, and review event registrations.
                </p>
              </div>
            </div>
          </div>
        </a>


        <div class="col-md-6 col-lg-3">
          <a class="action" href="{% url 'notices:create' %}">
            <div class="icon">NO</div>
            <div>
              <h6>Publish Notices</h6>
              <p>Post announcements for students and staff.</p>
            </div>
          </a>
        </div>

        <div class="col-md-6 col-lg-3">
          <a class="action" href="#" onclick="alert('Lost & Found module is coming next ✅'); return false;">
            <div class="icon">LF</div>
            <div>
              <h6>Lost &amp; Found</h6>
              <p>Manage found items and verify claim requests.</p>
            </div>
          </a>
        </div>

        <div class="cardx p-3">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div class="fw-bold">Payments Pending</div>
    <a class="text-decoration-none" href="{% url 'payments:staff_list' %}?status=pending">View all</a>
  </div>

  <div class="display-6 fw-bold">{{ payments_pending_count }}</div>
  <div class="text-muted small">Proofs waiting for verification</div>

  {% if pending_proofs %}
    <div class="mt-3">
      {% for p in pending_proofs %}
        <div class="d-flex justify-content-between align-items-center border-top pt-2 mt-2">
          <div>
            <div class="fw-semibold">{{ p.registration.event.title }}</div>
            <div class="text-muted small">by {{ p.registration.user.username }}</div>
          </div>
          <a class="btn btn-outline-dark btn-sm pill" href="{% url 'payments:staff_review' p.id %}">Review</a>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>

        <div class="col-md-6 col-lg-3">
          <a class="action" href="#" onclick="alert('Reports module is later ✅'); return false;">
            <div class="icon">RP</div>
            <div>
              <h6>Reports (Later)</h6>
              <p>Generate summaries of events and payments.</p>
            </div>
          </a>
        </div>
      </div>

      <!-- Two panels -->
      <div class="row g-3">
        <!-- Recent Notices (real DB-friendly section) -->
        <div class="col-lg-7">
          <div class="cc-card cc-card-pad">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="fw-bold" style="font-weight:950; letter-spacing:-0.01em;">Recent Notices</div>
              <a href="{% url 'notices:list' %}" class="small" style="font-weight:800; color: var(--green); text-decoration:none;">View all</a>
            </div>

            {% if recent_notices %}
              {% for n in recent_notices %}
                <div class="list-item">
                  <div>
                    <div class="list-title">{{ n.title }}</div>
                    <div class="list-meta">
                      Posted {{ n.created_at|date:"M d, Y" }} • {{ n.created_by.username|default:"Staff/Admin" }}
                    </div>
                  </div>
                  <span class="pill">{{ n.category|default:"Notice" }}</span>
                </div>
              {% endfor %}
            {% else %}
              <div class="small" style="color:var(--muted); font-weight:700;">
                No notices yet. Click <b>+ Create Notice</b> to publish your first announcement.
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Pending Claims (demo) -->
        <div class="col-lg-5">
          <div class="cc-card cc-card-pad">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="fw-bold" style="font-weight:950; letter-spacing:-0.01em;">Pending Lost &amp; Found Claims</div>
              <a href="#" class="small" style="font-weight:800; color: var(--green); text-decoration:none;"
                 onclick="alert('Lost & Found module is coming next ✅'); return false;">Review</a>
            </div>

            <div class="list-item">
              <div>
                <div class="list-title">Wallet (Black)</div>
                <div class="list-meta">Claimed by Student A • Today</div>
              </div>
              <span class="pill">Open</span>
            </div>

            <div class="list-item">
              <div>
                <div class="list-title">ID Card</div>
                <div class="list-meta">Claimed by Student B • Yesterday</div>
              </div>
              <span class="pill">Open</span>
            </div>

            <div class="mt-3 d-flex gap-2 flex-wrap">
              <a class="btn btn-pill btn-ghost" href="#" onclick="return false;">Reject</a>
              <a class="btn btn-primary-cc" href="#" onclick="return false;">Approve</a>
            </div>

            <div class="mt-3 small" style="color:var(--muted); font-weight:700;">
              In real implementation: staff/admin verifies proof then approves/rejects claim.
            </div>
          </div>
        </div>
      </div>

      <footer class="text-center">
        © 2026 Campus Connect. All rights reserved.
      </footer>
    </div>
  </main>
</body>
</html>
