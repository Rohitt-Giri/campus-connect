{% load static %}
<!doctype html>
<html>
<head>
<title>Admin Users</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4">

<h3 class="fw-bold mb-3">Admin â€” All Users</h3>

<form method="get" class="row g-2 mb-3">

  <div class="col-md-4">
    <input name="q" value="{{ q }}" class="form-control" placeholder="Search username">
  </div>

  <div class="col-md-2">
    <select name="role" class="form-select">
      <option value="">All Roles</option>
      <option value="STUDENT">Student</option>
      <option value="STAFF">Staff</option>
      <option value="ADMIN">Admin</option>
    </select>
  </div>

  <div class="col-md-2">
    <select name="approved" class="form-select">
      <option value="">Approval</option>
      <option value="yes">Approved</option>
      <option value="no">Pending</option>
    </select>
  </div>

  <div class="col-md-2">
    <button class="btn btn-dark w-100">Filter</button>
  </div>

</form>

{% if messages %}
  <div class="mb-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} mb-2">{{ message }}</div>
    {% endfor %}
  </div>
{% endif %}

<table class="table align-middle">
<thead>
<tr>
<th>User</th>
<th>Role</th>
<th>Approved</th>
<th>Active</th>
<th class="text-end">Actions</th>
</tr>
</thead>

<tbody>
{% for u in users %}
<tr>
<td>{{ u.username }}</td>
<td>{{ u.role }}</td>
<td>
  {% if u.is_approved %}
    <span class="badge bg-success">Yes</span>
  {% else %}
    <span class="badge bg-secondary">No</span>
  {% endif %}
</td>
<td>
  {% if u.is_active %}
    <span class="badge bg-success">Active</span>
  {% else %}
    <span class="badge bg-danger">Disabled</span>
  {% endif %}
</td>

<td class="text-end d-flex gap-2 justify-content-end">

  <form method="post" action="{% url 'accounts:admin_change_role' u.id %}">
    {% csrf_token %}
    <select name="role" class="form-select form-select-sm">
      <option value="STUDENT">Student</option>
      <option value="STAFF">Staff</option>
      <option value="ADMIN">Admin</option>
    </select>
    <button class="btn btn-outline-dark btn-sm mt-1">Update</button>
  </form>

  <form method="post" action="{% url 'accounts:admin_toggle_active' u.id %}">
    {% csrf_token %}
    <button class="btn btn-warning btn-sm">
      {% if u.is_active %}Deactivate{% else %}Activate{% endif %}
    </button>
  </form>

  <form method="post" action="{% url 'accounts:admin_resend_approval_email' u.id %}" class="d-inline">
    {% csrf_token %}
    <button class="btn btn-sm btn-outline-primary">Resend Approval Email</button>
  </form>

</td>
</tr>
{% endfor %}
</tbody>
</table>

</body>
</html>